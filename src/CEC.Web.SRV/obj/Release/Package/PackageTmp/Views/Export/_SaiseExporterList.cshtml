@using CEC.Web.SRV.Infrastructure.Grids
@using CEC.Web.SRV.Models.Export
@using CEC.Web.SRV.Resources
@using Lib.Web.Mvc.JQuery.JqGrid
@model CEC.Web.SRV.Models.Export.ExportRsaToSaiseModel

@{
	var grid = Html.GridOptions<ExportRsaToSaiseGridModel>("exportRsaToSaiseGrid")
		.BuildGrid(Url.Action("ListSaiseExporterStageAjax", "Export"))
        .Navigator(new JqGridNavigatorOptions
        {
            Add = false, 
            Edit = false, 
            Delete = false, 
            Search = true, 
            CloneToTop = true
        });

}


<div class="clearfix form-horizontal">
	@Html.HiddenFor(x=>x.IsProgress)
	@Html.HiddenFor(x=>x.SaiseExporterId)

	<div class="form-group" id="content_box">
		@Html.EditorFor(x => x.ElectionInfo.ElectionTypeName, new {ReadOnly = true})
	</div>
	<div class="form-group" style="padding-left: 15px ;padding-right: 15px">
		<p id="countdown"></p> 
		<div class="progress progress-striped">
			<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
				<span>0%  Complect</span>
			</div>
		</div>
	</div>
</div>

<div class="box">
	<div class="box-content">
		<h5 class="page-header">@MUI.SaiseExporter_ViewList</h5>
		@grid.GetHtml()
	</div>
</div>

<script type="text/javascript">
	var timeout = 0;
	
	$(document).ready(function () {
		@grid.GetJavaScript();
		updatePage();
		var timeLeft = 30;
		var countdown = document.getElementById('countdown');
		
		timeout = setInterval(function () {
			if (timeLeft == 0) {
				updatePage();
				timeLeft = 30;
			} else {
				countdown.innerHTML = '' + '<span> Pîna la următoarea actualizare au mai rămas ' + timeLeft + ' secunde</span>';
				timeLeft--;
			}
		}, 1000);
	});
	
	function updatePage() {
		var url = '@Url.Action("GetProgressOfSaiseExporter")';
		var saiseExporterId = $('#SaiseExporterId').val();
		$.ajax({
			type: "POST",
			dataType: 'json',
			url: url,
			data: { saiseExporterId: saiseExporterId },
			success: function (data) {
				if (data.Error) {
					clearTimeout(timeout);
					countdown.innerHTML = '' + '<span> A avut loc o eroare </span>';
					$('#countdown').css('color', 'red');
					$('.progress').hide();
				}

				$('.progress-bar-success').css("width", data.Progres + '%');
				$('.progress-bar-success span').text(data.Progres + '%');
				$('.progress-bar-success').attr('aria-valuenow', data.Progres);
				$('#exportRsaToSaiseGrid').jqGrid().trigger('reloadGrid');
				if (data.Progres == 100) {
					clearTimeout(timeout);
					countdown.innerHTML = '' + '<span> Exportul a avut loc cu succes </span>';
				}
			}
		});
	}

	$('#content_box .rsa-form-group > div.col-sm-4').removeClass('col-sm-4').addClass('col-sm-6');
</script>




