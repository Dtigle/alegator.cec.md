@using CEC.SRV.BLL
@using CEC.SRV.Domain
@using CEC.SRV.Domain.Constants
@using CEC.Web.SRV.Controllers

@{
    ViewBag.Title = "Home Page";
}

<div id="dashboard-header" class="row">
    <div class="col-xs-10 col-sm-2">
        <h3>Salut, @ViewBag.CurrentUserName</h3>
    </div>
    <div class="col-xs-10 col-sm-2">
        <a href="http://www.cec.md">Site-ul oficial al Comisiei Electorale Centrale</a>
    </div>
    @if (SecurityHelper.LoggedUserIsInRole(Transactions.Administrator))
    {
        <div class="col-xs-10 col-sm-2">
            <a href="~/Content/docs/Administrator Guide.pdf" target="blank">Ghidul administratorului</a>
        </div>
    }
    <div class="col-xs-10 col-sm-2">
        <a href="~/Content/docs/Registrator Guide.pdf" target="blank">Ghidul utilizatorului</a>
    </div>
    <div class="col-xs-10 col-sm-2">
        <a href="~/VideoMenu.html" target="blank">Ghid de utilizare (curs video)</a>
    </div>

</div>


<div class="box">
    <div class="box-content">
        @Html.Partial("_FilterForHome")
    </div>
</div>

<div id="dashboardData">
    <div class="row-fluid">
        <div id="dashboard_links" class="col-xs-12 col-sm-2 pull-right">
            <ul class="nav nav-pills nav-stacked">
                <li><a href="#overview" class="tab-link">Informații</a></li>
            </ul>
            <ul class="nav nav-pills nav-stacked">
                <li><a href="#age-distribution" class="tab-link">Distribuția pe vîrste</a></li>
            </ul>
            <ul class="nav nav-pills nav-stacked">
                <li><a href="#problematic-data" class="tab-link">Date problematice</a></li>
            </ul>
            <ul class="nav nav-pills nav-stacked">
                <li><a href="#import-statistics" class="tab-link">Statistici la importare</a></li>
            </ul>
            <ul class="nav nav-pills nav-stacked">
                <li><a href="#ps-statistics" class="tab-link">Alegători / Secție</a></li>
            </ul>
        </div>
        <div id="dashboard_tabs" class="col-xs-12 col-sm-10">

        </div>
    </div>
</div>


<script type="text/javascript">
    google.load("visualization", "1", { packages: ["corechart"] });
    //google.setOnLoadCallback($(document).ready(function () {
        //$.loadDashBoardFunction = $.loadInfoTab;
        //$.loadInfoTab();
    //}));

    $.loadInfoTab = function () {
        $.ajax({
            url: '@Url.Action("LoadInfoTab", "Statistics")',
            type: "GET",

            success: function (data) {
                $('#dashboard_tabs').html(data);
            }
        });
    };

    $.loadAgeDistributionTab = function () {
        $.ajax({
            url: '@Url.Action("LoadAgeDistributionTab", "Statistics")',
            type: "GET",

            success: function (data) {
                $('#dashboard_tabs').html(data);
            }
        });
    };

    $.loadProblematicDataTab = function () {
        $.ajax({
            url: '@Url.Action("LoadProblematicDataTab", "Statistics")',
            type: "GET",

            success: function (data) {
                $('#dashboard_tabs').html(data);
            }
        });
    };

    $.loadStatisticsFromImportTab = function () {
        $.ajax({
            url: '@Url.Action("LoadStatisticsFromImportTab", "Statistics")',
            type: "GET",

            success: function (data) {
                $('#dashboard_tabs').html(data);
            }
        });
    };

    $.loadStatisticsForPollingStation = function () {
        $.ajax({
            url: '@Url.Action("LoadStatisticsForPollingStation", "Statistics")',
            type: "GET",

            success: function (data) {
                $('#dashboard_tabs').html(data);
            }
        });
    };


    $(document).ready(function () {

        function showTab(loaderFunction, $tab) {
            $.loadDashBoardFunction = loaderFunction;

            $("#dashboard_links li.active").removeClass("active");

            $tab.parent().addClass("active");

            loaderFunction();
        }

        var hashes = {

            "#overview": {
                handler: function () {
                    showTab($.loadInfoTab, $('a[href="#overview"]'));
                }
            },

            "#age-distribution": {
                handler: function () {
                    showTab($.loadAgeDistributionTab, $('a[href="#age-distribution"]'));
                }
            },

            "#problematic-data": {
                handler: function () {
                    showTab($.loadProblematicDataTab, $('a[href="#problematic-data"]'));
                }
            },

            "#import-statistics": {
                handler: function () {
                    showTab($.loadStatisticsFromImportTab, $('a[href="#import-statistics"]'));
                }
            },

            "#ps-statistics": {
                handler: function () {
                    showTab($.loadStatisticsForPollingStation, $('a[href="#ps-statistics"]'));
                }
            },

            "default": "#overview"
        };

        function processHash() {
            var hash = window.location.hash;

            var hashInfo = hashes[hash];
            if (!hashInfo) {
                window.location.hash = hashes["default"];
                return;
            }

            hashInfo.handler();
        }

        $(window).bind('hashchange', function () { //detect hash change
            processHash();
        });

        processHash();

    });
</script>
